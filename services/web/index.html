<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Videos</title>
  <style>
    body { font-family: sans-serif; }
    .row { display:flex; gap: 20px; }
    .list { width: 420px; }
    .card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; cursor: pointer; }
    video { width: 640px; max-width: 100%; }
  </style>
</head>
<body>
  <h1>Video Streaming</h1>

  <p>
    <a href="/upload.html">Upload</a> |
    <a href="/login.html">Login</a> |
    <a href="/settings.html">Settings</a>
  </p>

  <div class="row">
    <div class="list">
      <button id="refreshBtn">Refresh List</button>
      <p id="status"></p>
      <div id="videos"></div>
    </div>

    <div>
      <h3 id="playerTitle">Select a video</h3>
      <video id="player" controls></video>
      <p id="playerUrl"></p>
    </div>
  </div>

<script>
  function base(key, fallback) {
    return localStorage.getItem(key) || fallback;
  }
  const apiBase = () => base("apiBase", "http://localhost:5001");
  const fileBase = () => base("fileBase", "http://localhost:5002");

  function getToken() { return sessionStorage.getItem("token"); }

  async function loadVideos() {
    const status = document.getElementById("status");
    status.textContent = "Loading...";

    const res = await fetch(`${apiBase()}/videos`);
    const data = await res.json().catch(() => []);

    if (!res.ok) {
      status.textContent = `Failed to load videos: ${res.status}`;
      return;
    }

    status.textContent = `Found ${data.length} video(s).`;
    const wrap = document.getElementById("videos");
    wrap.innerHTML = "";

    data.forEach(v => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `<b>${v.title}</b><br/><small>${v.path}</small>`;
      div.onclick = () => {
        const url = `${fileBase()}${v.path}`;
        document.getElementById("playerTitle").textContent = v.title;
        document.getElementById("player").src = url;
        document.getElementById("playerUrl").textContent = url;
      };
      wrap.appendChild(div);
    });
  }

  document.getElementById("refreshBtn").onclick = loadVideos;

  // optional note about login
  if (!getToken()) {
    document.getElementById("status").textContent = "Note: Upload requires login. Streaming list/play works without login.";
  }

  loadVideos();
</script>
</body>
</html>

